<!DOCTYPE html>
<html lang="en"
      xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:p="http://primefaces.org/ui">
<head>
    <meta charset="UTF-8"/>
    <meta http-equiv="X-UA-Compatible" content="IE=edge"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <link rel="stylesheet" href="Login.css"/>
    <title>Login</title>
</head>
<body>
<h:form>
    <div class="main-login">
        <div class="left-login">
            <h1> Le Créole Hortifruti<br/> Faça login </h1>
            <img src="feria.svg" class="left-login-image" alt="Feria animação"/>
        </div>
        <div class="right-login">
            <div class="card-login">
                <h1>LOGIN</h1>
                <div class="textfield">
                    <label for="usuario"> Usuário</label>
                    <p:inputText id="usuario" name="usuario" placeholder="Usuário" value="#{loginController.usuario.usuario}"/>
                </div>
                <div class="textfield">
                    <label for="senha"> Senha</label>
                    <p:password id="senha" name="senha" placeholder="Senha" value="#{loginController.usuario.senha}"/>
                </div>
                <p:commandButton value="Login" action="#{loginController.login}" ajax="false" class="btn-login"/>
                <a href="Cadastra1.xhtml">Cadastra-se agora</a>
            </div>
        </div>
    </div>
</h:form>
</body>
</html>

-- Table: public.product

-- DROP TABLE IF EXISTS public.product;

CREATE TABLE IF NOT EXISTS public.product
(
    id integer NOT NULL DEFAULT 'nextval('product_id_product_seq'::regclass)',
    nome text COLLATE pg_catalog."default",
    codigo integer,
    quantitykl numeric(10,2),
    quantityint numeric(10,2),
    priceund numeric(10,2),
    pricekl numeric(10,2),
    quantidadetotalemestoque numeric(10,2),
    precototalemestoque numeric(10,2) NOT NULL,
    CONSTRAINT product_pkey PRIMARY KEY (id),
    CONSTRAINT product_nome_key UNIQUE (nome)
)

TABLESPACE pg_default;

ALTER TABLE IF EXISTS public.product
    OWNER to postgres;

GRANT DELETE, INSERT, SELECT, UPDATE ON TABLE public.product TO aplicacao_user;

GRANT ALL ON TABLE public.product TO postgres;


-- Table: public.usuario

-- DROP TABLE IF EXISTS public.usuario;

CREATE TABLE IF NOT EXISTS public.usuario
(
    id_usuario integer NOT NULL DEFAULT 'nextval('usuario_id_usuario_seq'::regclass)',
    usuario text COLLATE pg_catalog."default" NOT NULL,
    email text COLLATE pg_catalog."default" NOT NULL,
    senha text COLLATE pg_catalog."default" NOT NULL,
    cidade text COLLATE pg_catalog."default",
    pais text COLLATE pg_catalog."default",
    cpf text COLLATE pg_catalog."default",
    CONSTRAINT usuario_pkey PRIMARY KEY (id_usuario),
    CONSTRAINT usuario_usuario_key UNIQUE (usuario)
)

TABLESPACE pg_default;

ALTER TABLE IF EXISTS public.usuario
    OWNER to postgres;

GRANT DELETE, INSERT, SELECT, UPDATE ON TABLE public.usuario TO aplicacao_user;

GRANT ALL ON TABLE public.usuario TO postgres;

-- Table: public.venda

-- DROP TABLE IF EXISTS public.venda;

CREATE TABLE IF NOT EXISTS public.venda
(
    id integer NOT NULL,
    codigoproduto text COLLATE pg_catalog."default" NOT NULL,
    quantidade integer NOT NULL,
    preco numeric(10,2) NOT NULL,
    formapagamento character varying(50) COLLATE pg_catalog."default" NOT NULL,
    datavenda date,
    CONSTRAINT venda_pkey PRIMARY KEY (id)
)

TABLESPACE pg_default;

ALTER TABLE IF EXISTS public.venda
    OWNER to postgres;

GRANT DELETE, INSERT, SELECT, UPDATE ON TABLE public.venda TO aplicacao_user;

GRANT ALL ON TABLE public.venda TO postgres;

-- Início SQL

-- Remove tabelas caso já existam
-- DROP TABLE permissao, usuario, tipo_permissao;

-- Cria tabela para usuário do sistema e inicializa com dois usuários iniciais
CREATE TABLE IF NOT EXISTS public.usuario
(
    id_usuario SERIAL, 
    usuario text NOT NULL UNIQUE,
	email text NOT NULL,
	senha text NOT NULL,
	cidade text NOT NULL,
	pais text NOT NULL,
    cpf text NOT NULL,
    
    CONSTRAINT usuario_pkey PRIMARY KEY (id_usuario)
);

CREATE TABLE IF NOT EXISTS public.product
(
    id_product SERIAL, 
    nome text NOT NULL UNIQUE,
	codigo integer,
    quantitykl numeric(10,2),
    quantityint numeric(10,2),
    priceund numeric(10,2),
    pricekl numeric(10,2),
    quantidadetotalemestoque numeric(10,2),
    precototalemestoque numeric(10,2) NOT NULL,
    
    CONSTRAINT product_pkey PRIMARY KEY (id_product)
);

CREATE TABLE IF NOT EXISTS public.venda
(
    id_venda SERIAL, 
    codigoproduto text NOT NULL UNIQUE,
	 quantidade integer NOT NULL,
    preco numeric(10,2) NOT NULL,
    formapagamento text NOT NULL,
    datavenda date,
    
    CONSTRAINT venda_pkey PRIMARY KEY (id_venda)
);

-- Cria tabela para tipos de permissões usadas no sistema e inicializa com dois valores
CREATE TABLE IF NOT EXISTS public.tipo_permissao
(
    id_tipo_permissao SERIAL,
    permissao text NOT NULL,
    CONSTRAINT tipo_permissao_pkey PRIMARY KEY (id_tipo_permissao)
);
-- Inicializa tipos de permissao do sistema
INSERT INTO tipo_permissao (permissao) VALUES ('ADMINISTRADOR');
INSERT INTO tipo_permissao (permissao) VALUES ('CLIENTE');
INSERT INTO tipo_permissao (permissao) VALUES ('SERVIDOR');

-- Cria tabela de relacionamento nxn entre usuários e tipos de permissões
CREATE TABLE IF NOT EXISTS public.permissao
(
    id_usuario bigint NOT NULL,
	id_product bigint NOT NULL,
	id_venda bigint NOT NULL,
    id_tipo_permissao bigint NOT NULL,
    CONSTRAINT permissao_pkey PRIMARY KEY (id_usuario, id_tipo_permissao),
    CONSTRAINT permissao_usuario_fkey FOREIGN KEY (id_usuario) REFERENCES usuario (id_usuario) ON DELETE CASCADE,
    CONSTRAINT permissao_tipo_permissao_fkey FOREIGN KEY (id_tipo_permissao) REFERENCES tipo_permissao (id_tipo_permissao) ON DELETE CASCADE
);

-- Conceda permissões ao usuário do banco que será usado pela aplicação
GRANT SELECT, INSERT, UPDATE, DELETE ON ALL TABLES IN SCHEMA "public" to aplicacao_user;
GRANT SELECT, USAGE, UPDATE ON ALL SEQUENCES IN SCHEMA "public" to aplicacao_user;
-- Fim SQL

<!DOCTYPE html>
<html lang="en"
      xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:p="http://primefaces.org/ui">
<head>
    <meta charset="UTF-8"/>
    <meta http-equiv="X-UA-Compatible" content="IE=edge"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <link rel="stylesheet" href="Login.css"/>
    <title>Login</title>
</head>
<body>
<h:form>
    <div class="main-login">
        <div class="left-login">
            <h1> Le Créole Hortifruti<br/> Faça login </h1>
            <img src="feria.svg" class="left-login-image" alt="Feria animação"/>
        </div>
        <div class="right-login">
            <div class="card-login">
                <h1>LOGIN</h1>
                <div class="textfield">
                    <label for="usuario"> Usuário</label>
                    <p:inputText id="usuario" name="usuario" placeholder="Usuário" value="#{loginController.usuario.usuario}"/>
                </div>
                <div class="textfield">
                    <label for="senha"> Senha</label>
                    <p:password id="senha" name="senha" placeholder="Senha" value="#{loginController.usuario.senha}"/>
                </div>
                <p:commandButton value="Login" action="#{loginController.login}" ajax="false" class="btn-login"/>
                <a href="Cadastra1.xhtml">Cadastra-se agora</a>
            </div>
        </div>
    </div>
</h:form>
</body>
</html>

-- Table: public.product

-- DROP TABLE IF EXISTS public.product;

CREATE TABLE IF NOT EXISTS public.product
(
    id integer NOT NULL DEFAULT 'nextval('product_id_product_seq'::regclass)',
    nome text COLLATE pg_catalog."default",
    codigo integer,
    quantitykl numeric(10,2),
    quantityint numeric(10,2),
    priceund numeric(10,2),
    pricekl numeric(10,2),
    quantidadetotalemestoque numeric(10,2),
    precototalemestoque numeric(10,2) NOT NULL,
    CONSTRAINT product_pkey PRIMARY KEY (id),
    CONSTRAINT product_nome_key UNIQUE (nome)
)

TABLESPACE pg_default;

ALTER TABLE IF EXISTS public.product
    OWNER to postgres;

GRANT DELETE, INSERT, SELECT, UPDATE ON TABLE public.product TO aplicacao_user;

GRANT ALL ON TABLE public.product TO postgres;


-- Table: public.usuario

-- DROP TABLE IF EXISTS public.usuario;

CREATE TABLE IF NOT EXISTS public.usuario
(
    id_usuario integer NOT NULL DEFAULT 'nextval('usuario_id_usuario_seq'::regclass)',
    usuario text COLLATE pg_catalog."default" NOT NULL,
    email text COLLATE pg_catalog."default" NOT NULL,
    senha text COLLATE pg_catalog."default" NOT NULL,
    cidade text COLLATE pg_catalog."default",
    pais text COLLATE pg_catalog."default",
    cpf text COLLATE pg_catalog."default",
    CONSTRAINT usuario_pkey PRIMARY KEY (id_usuario),
    CONSTRAINT usuario_usuario_key UNIQUE (usuario)
)

TABLESPACE pg_default;

ALTER TABLE IF EXISTS public.usuario
    OWNER to postgres;

GRANT DELETE, INSERT, SELECT, UPDATE ON TABLE public.usuario TO aplicacao_user;

GRANT ALL ON TABLE public.usuario TO postgres;

-- Table: public.venda

-- DROP TABLE IF EXISTS public.venda;

CREATE TABLE IF NOT EXISTS public.venda
(
    id integer NOT NULL,
    codigoproduto text COLLATE pg_catalog."default" NOT NULL,
    quantidade integer NOT NULL,
    preco numeric(10,2) NOT NULL,
    formapagamento character varying(50) COLLATE pg_catalog."default" NOT NULL,
    datavenda date,
    CONSTRAINT venda_pkey PRIMARY KEY (id)
)

TABLESPACE pg_default;

ALTER TABLE IF EXISTS public.venda
    OWNER to postgres;

GRANT DELETE, INSERT, SELECT, UPDATE ON TABLE public.venda TO aplicacao_user;

GRANT ALL ON TABLE public.venda TO postgres;

-- Início SQL

-- Remove tabelas caso já existam
-- DROP TABLE permissao, usuario, tipo_permissao;

-- Cria tabela para usuário do sistema e inicializa com dois usuários iniciais
CREATE TABLE IF NOT EXISTS public.usuario
(
    id_usuario SERIAL, 
    usuario text NOT NULL UNIQUE,
	email text NOT NULL,
	senha text NOT NULL,
	cidade text NOT NULL,
	pais text NOT NULL,
    cpf text NOT NULL,
    
    CONSTRAINT usuario_pkey PRIMARY KEY (id_usuario)
);

CREATE TABLE IF NOT EXISTS public.product
(
    id_product SERIAL, 
    nome text NOT NULL UNIQUE,
	codigo integer,
    quantitykl numeric(10,2),
    quantityint numeric(10,2),
    priceund numeric(10,2),
    pricekl numeric(10,2),
    quantidadetotalemestoque numeric(10,2),
    precototalemestoque numeric(10,2) NOT NULL,
    
    CONSTRAINT product_pkey PRIMARY KEY (id_product)
);

CREATE TABLE IF NOT EXISTS public.venda
(
    id_venda SERIAL, 
    codigoproduto text NOT NULL UNIQUE,
	 quantidade integer NOT NULL,
    preco numeric(10,2) NOT NULL,
    formapagamento text NOT NULL,
    datavenda date,
    
    CONSTRAINT venda_pkey PRIMARY KEY (id_venda)
);

-- Cria tabela para tipos de permissões usadas no sistema e inicializa com dois valores
CREATE TABLE IF NOT EXISTS public.tipo_permissao
(
    id_tipo_permissao SERIAL,
    permissao text NOT NULL,
    CONSTRAINT tipo_permissao_pkey PRIMARY KEY (id_tipo_permissao)
);
-- Inicializa tipos de permissao do sistema
INSERT INTO tipo_permissao (permissao) VALUES ('ADMINISTRADOR');
INSERT INTO tipo_permissao (permissao) VALUES ('CLIENTE');
INSERT INTO tipo_permissao (permissao) VALUES ('SERVIDOR');

-- Cria tabela de relacionamento nxn entre usuários e tipos de permissões
CREATE TABLE IF NOT EXISTS public.permissao
(
    id_usuario bigint NOT NULL,
	id_product bigint NOT NULL,
	id_venda bigint NOT NULL,
    id_tipo_permissao bigint NOT NULL,
    CONSTRAINT permissao_pkey PRIMARY KEY (id_usuario, id_product, id_venda, id_tipo_permissao),
    CONSTRAINT permissao_usuario_fkey FOREIGN KEY (id_usuario) REFERENCES usuario (id_usuario) ON DELETE CASCADE,
	CONSTRAINT permissao_product_fkey FOREIGN KEY (id_product) REFERENCES usuario (id_product) ON DELETE CASCADE,
	CONSTRAINT permissao_venda_fkey FOREIGN KEY (id_venda) REFERENCES usuario (id_venda) ON DELETE CASCADE,
    CONSTRAINT permissao_tipo_permissao_fkey FOREIGN KEY (id_tipo_permissao) REFERENCES tipo_permissao (id_tipo_permissao) ON DELETE CASCADE
);

-- Conceda permissões ao usuário do banco que será usado pela aplicação
GRANT SELECT, INSERT, UPDATE, DELETE ON ALL TABLES IN SCHEMA "public" to aplicacao_user;
GRANT SELECT, USAGE, UPDATE ON ALL SEQUENCES IN SCHEMA "public" to aplicacao_user;
-- Fim SQL


-- Início SQL

-- Remove tabelas caso já existam
-- DROP TABLE permissao, usuario, tipo_permissao;

-- Cria tabela para usuário do sistema e inicializa com dois usuários iniciais
CREATE TABLE IF NOT EXISTS public.usuario
(
    id_usuario SERIAL, 
    usuario text NOT NULL UNIQUE,
	email text NOT NULL,
	senha text NOT NULL,
	cidade text NOT NULL,
	pais text NOT NULL,
    cpf text NOT NULL,
    
    CONSTRAINT usuario_pkey PRIMARY KEY (id_usuario)
);



CREATE TABLE IF NOT EXISTS public.product
(
    id_product SERIAL, 
    nome text NOT NULL UNIQUE,
	codigo integer,
    quantitykl numeric(10,2),
    quantityint numeric(10,2),
    priceund numeric(10,2),
    pricekl numeric(10,2),
    quantidadetotalemestoque numeric(10,2),
    precototalemestoque numeric(10,2) NOT NULL,
    
    CONSTRAINT product_pkey PRIMARY KEY (id_product)
);

CREATE TABLE IF NOT EXISTS public.venda
(
    id_venda SERIAL, 
    codigoproduto text NOT NULL UNIQUE,
	quantidade integer NOT NULL,
    preco numeric(10,2) NOT NULL,
    formapagamento text NOT NULL,
    datavenda date,
    
    CONSTRAINT venda_pkey PRIMARY KEY (id_venda)
);

-- Cria tabela para tipos de permissões usadas no sistema e inicializa com dois valores
CREATE TABLE IF NOT EXISTS public.tipo_permissao
(
    id_tipo_permissao SERIAL,
    permissao text NOT NULL,
    CONSTRAINT tipo_permissao_pkey PRIMARY KEY (id_tipo_permissao)
);
-- Inicializa tipos de permissao do sistema
INSERT INTO tipo_permissao (permissao) VALUES ('ADMINISTRADOR');
INSERT INTO tipo_permissao (permissao) VALUES ('CLIENTE');
INSERT INTO tipo_permissao (permissao) VALUES ('SERVIDOR');

-- Cria tabela de relacionamento nxn entre usuários e tipos de permissões
CREATE TABLE IF NOT EXISTS public.permissao
(
    id_usuario bigint NOT NULL,
	id_product bigint NOT NULL,
	id_venda bigint NOT NULL,
    id_tipo_permissao bigint NOT NULL,
    CONSTRAINT permissao_pkey PRIMARY KEY (id_usuario, id_product, id_venda, id_tipo_permissao),
    CONSTRAINT permissao_usuario_fkey FOREIGN KEY (id_usuario) REFERENCES usuario (id_usuario) ON DELETE CASCADE,
	CONSTRAINT permissao_product_fkey FOREIGN KEY (id_product) REFERENCES product (id_product) ON DELETE CASCADE,
	CONSTRAINT permissao_venda_fkey FOREIGN KEY (id_venda) REFERENCES venda (id_venda) ON DELETE CASCADE,
    CONSTRAINT permissao_tipo_permissao_fkey FOREIGN KEY (id_tipo_permissao) REFERENCES tipo_permissao (id_tipo_permissao) ON DELETE CASCADE
);

-- Conceda permissões ao usuário do banco que será usado pela aplicação
GRANT SELECT, INSERT, UPDATE, DELETE ON ALL TABLES IN SCHEMA "public" to aplicacao_user;
GRANT SELECT, USAGE, UPDATE ON ALL SEQUENCES IN SCHEMA "public" to aplicacao_user;
-- Fim SQL